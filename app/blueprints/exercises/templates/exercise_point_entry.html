{% extends "base.html" %}
{% from "macros.html" import page_header, data_table %}

{% block title %}Point Entry - {{ exercise.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    {% call page_header(
        exercise.name,
        subtitle=exercise.competition.name
    ) %}
    {% endcall %}
    
    <p class="text-muted mb-4">
        Max Points: <strong>{{ exercise.max_points }}</strong>
        {% if exercise.helper %}
        | Helper: <strong>{{ exercise.helper.username }}</strong>
        {% endif %}
    </p>

    <hr>

    <form method="POST" class="form">
        {% call data_table(['Starter', 'Points (0-' + exercise.max_points|string + ')', 'Notes']) %}
            {% for starter in starters %}
            <tr>
                <td>
                    <strong>
                        {% if starter.person %}
                            {{ starter.person.given_name }} {{ starter.person.family_name }}
                        {% endif %}
                        {% if starter.dog %}
                            <br><small>({{ starter.dog.name }})</small>
                        {% endif %}
                    </strong>
                </td>
                <td style="width: 120px;">
                    <input type="number" 
                           class="form-control" 
                           name="points_{{ starter.id }}"
                           value="{{ point_entries.get(starter.id).points if point_entries.get(starter.id) else '' }}"
                           min="0" 
                           max="{{ exercise.max_points }}">
                </td>
                <td>
                    <textarea class="form-control" 
                              name="notes_{{ starter.id }}"
                              rows="1"
                              placeholder="Optional notes">{{ point_entries.get(starter.id).notes if point_entries.get(starter.id) else '' }}</textarea>
                </td>
            </tr>
            {% endfor %}
        {% endcall %}

        <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-primary">Save Points</button>
            <a href="{{ url_for('exercises.wt_exercises', competition_id=exercise.competition_id) }}" class="btn btn-secondary">
                Back to Exercises
            </a>
        </div>
    </form>
</div>
{% endblock %}
