{# Macro: Page Header with Title and Subtitle #}
{% macro page_header(title, subtitle='', level='', location='', date='') %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1>{{ title }}</h1>
        {% if subtitle %}
        <p class="text-muted">{{ subtitle }}</p>
        {% endif %}
        {% if level or location or date %}
        <p class="text-muted">
            {% if level %}<strong>{{ level }}</strong>{% if location %} | {% endif %}{% endif %}
            {% if location %}{{ location }}{% if date %} | {% endif %}{% endif %}
            {% if date %}{{ date }}{% endif %}
        </p>
        {% endif %}
    </div>
    {% if caller %}
    <div class="col-md-4 text-end">
        {{ caller() }}
    </div>
    {% endif %}
</div>
{% endmacro %}

{# Macro: Button Group #}
{% macro button_group(buttons=[]) %}
<div class="d-flex gap-2">
    {% for button in buttons %}
        {% if button.type == 'submit' %}
        <button type="submit" class="btn btn-{{ button.style|default('primary') }}">
            {{ button.label }}
        </button>
        {% elif button.type == 'link' %}
        <a href="{{ button.url }}" class="btn btn-{{ button.style|default('secondary') }}">
            {{ button.label }}
        </a>
        {% elif button.type == 'form' %}
        <form method="POST" action="{{ button.url }}" style="display:inline;" {% if button.confirm %}onsubmit="return confirm('{{ button.confirm }}');"{% endif %}>
            <button type="submit" class="btn btn-{{ button.style|default('danger') }}">
                {{ button.label }}
            </button>
        </form>
        {% endif %}
    {% endfor %}
    {{ caller() if caller }}
</div>
{% endmacro %}

{# Macro: Form with Bootstrap Layout #}
{% macro form_section(title, action_url='', method='POST', submit_label='Submit', cancel_url='', show_flash=true) %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1>{{ title }}</h1>
            
            {% if show_flash %}
                {{ flash_messages() }}
            {% endif %}
            
            <form method="{{ method }}" action="{{ action_url }}" class="form">
                {{ caller() }}
                
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">{{ submit_label }}</button>
                    {% if cancel_url %}
                    <a href="{{ cancel_url }}" class="btn btn-secondary">Cancel</a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>
{% endmacro %}

{# Macro: Form Input Field with Bootstrap classes #}
{% macro input_field(name, label, value='', type='text', required=false, min=none, max=none, placeholder='') %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}{% if required %} *{% endif %}</label>
    <input 
        type="{{ type }}" 
        class="form-control" 
        id="{{ name }}"
        name="{{ name }}" 
        value="{{ value }}"
        {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
        {% if required %}required{% endif %}
        {% if min is not none %}min="{{ min }}"{% endif %}
        {% if max is not none %}max="{{ max }}"{% endif %}
    >
</div>
{% endmacro %}

{# Macro: Form Select Field with Bootstrap classes #}
{% macro select_field(name, label, options, selected='', required=false, empty_option='-- Select --') %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}</label>
    <select class="form-select" id="{{ name }}" name="{{ name }}" {% if required %}required{% endif %}>
        {% if empty_option %}
        <option value="">{{ empty_option }}</option>
        {% endif %}
        {% for value, text in options %}
            <option value="{{ value }}" {% if value == selected or value|string == selected|string %}selected{% endif %}>
                {{ text }}
            </option>
        {% endfor %}
    </select>
</div>
{% endmacro %}

{# Macro: Form Textarea Field #}
{% macro textarea_field(name, label, value='', placeholder='', required=false, rows=3) %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}</label>
    <textarea 
        class="form-control" 
        id="{{ name }}"
        name="{{ name }}"
        rows="{{ rows }}"
        {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
        {% if required %}required{% endif %}
    >{{ value }}</textarea>
</div>
{% endmacro %}

{# Macro: Alert Box #}
{% macro alert_box(message, type='info', title='') %}
<div class="alert alert-{{ type }}" role="alert">
    {% if title %}<strong>{{ title }}</strong><br>{% endif %}
    {{ message }}
</div>
{% endmacro %}

{# Macro: Empty State Message #}
{% macro empty_state(title, message, action_url='', action_label='') %}
<div class="alert alert-info" role="alert">
    <strong>{{ title }}</strong><br>
    {{ message }}
    {% if action_url %}
    <br><a href="{{ action_url }}" class="alert-link">{{ action_label }}</a>
    {% endif %}
</div>
{% endmacro %}

{# Macro: Table with Dark Header #}
{% macro data_table(headers=[]) %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                {% for header in headers %}
                <th scope="col">{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {{ caller() }}
        </tbody>
    </table>
</div>
{% endmacro %}

{# Macro: Action Buttons for Table Rows #}
{% macro action_buttons(buttons=[]) %}
<div class="btn-group btn-group-sm" role="group">
    {% for btn in buttons %}
        {% if btn.type == 'link' %}
        <a href="{{ btn.url }}" class="btn btn-{{ btn.style|default('info') }}" title="{{ btn.title|default('') }}">
            {{ btn.label }}
        </a>
        {% elif btn.type == 'submit' %}
        <form method="POST" action="{{ btn.url }}" style="display:inline;" 
              {% if btn.confirm %}onsubmit="return confirm('{{ btn.confirm }}');"{% endif %}>
            <button type="submit" class="btn btn-{{ btn.style|default('danger') }}" title="{{ btn.title|default('') }}">
                {{ btn.label }}
            </button>
        </form>
        {% endif %}
    {% endfor %}
</div>
{% endmacro %}

{# Macro: Badge with Status #}
{% macro status_badge(published, published_label='Published', unpublished_label='Not Published') %}
{% if published %}
    <span class="badge bg-success">{{ published_label }}</span>
{% else %}
    <span class="badge bg-danger">{{ unpublished_label }}</span>
{% endif %}
{% endmacro %}

{# Macro: Ranking Badge with Medal #}
{% macro ranking_badge(rank) %}
{% if rank == 1 %}
    <span class="fw-bold">ðŸ¥‡ 1st</span>
{% elif rank == 2 %}
    <span class="fw-bold">ðŸ¥ˆ 2nd</span>
{% elif rank == 3 %}
    <span class="fw-bold">ðŸ¥‰ 3rd</span>
{% else %}
    <span class="fw-bold">{{ rank }}</span>
{% endif %}
{% endmacro %}

{# Macro: Old-style Table (deprecated - use data_table instead) #}
{% macro table(headers) %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="thead-dark">
            <tr>
                {% for header in headers %}
                <th scope="col">{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {{ caller() }}
        </tbody>
    </table>
</div>
{% endmacro %}

{# Macro: Clickable Table Row #}
{% macro table_row(url) %}
<tr onclick="window.location='{{ url }}'" style="cursor: pointer;">
    {{ caller() }}
</tr>
{% endmacro %}

{# Macro: Table Form (for main index page) #}
{% macro table_form(title, competitions, show_flash=true) %}
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">{{ title }}</h1>
                
                {% if show_flash %}
                    {{ flash_messages() }}
                {% endif %}
                
                <!-- Table for medium and larger screens -->
                <div class="table-container d-none d-md-block">
                    {{ caller() }}
                </div>
                
                <!-- Cards for small screens -->
                <div class="card-container d-block d-md-none">
                    {% for competition in competitions %}
                    <div class="card mb-3" onclick="window.location='{{ url_for('wts.wt_details', competition_id=competition.id) }}'" style="cursor: pointer;">
                        <div class="card-body">
                            <h5 class="card-title">{{ competition.name }}</h5>
                            <p class="card-text">
                                <strong>Level:</strong> {{ competition.level }}<br>
                                <strong>Location:</strong> {{ competition.location }}<br>
                                <strong>Date:</strong> {{ competition.date }}
                            </p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{# Macro: Flash Messages Anzeige #}
{% macro flash_messages() %}
{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-info">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
{% endmacro %}
