{# ============================================================================ #}
{# MACROS - ORGANIZED TEMPLATE MACROS                                         #}
{# ============================================================================ #}
{# This file contains all template macros organized by category.              #}
{# Categories:                                                                 #}
{#   1. Layout Macros      - Page structure and headers                       #}
{#   2. Form Macros        - Form components and inputs                       #}
{#   3. Table Macros       - Data tables and table components                 #}
{#   4. UI Component Macros - Buttons, badges, alerts, etc.                   #}
{#   5. Legacy Macros      - Deprecated macros for backward compatibility     #}
{# ============================================================================ #}


{# ============================================================================ #}
{# 1. LAYOUT MACROS                                                            #}
{# ============================================================================ #}

{# Page Header with Title, Subtitle, and Optional Metadata #}
{% macro page_header(title, subtitle='', level='', location='', date='') %}
<div class="row mb-4">
    <div class="col-md-8">
        <h1>{{ title }}</h1>
        {% if subtitle %}
        <p class="text-muted">{{ subtitle }}</p>
        {% endif %}
        {% if level or location or date %}
        <p class="text-muted">
            {% if level %}<strong>{{ level }}</strong>{% if location %} | {% endif %}{% endif %}
            {% if location %}{{ location }}{% if date %} | {% endif %}{% endif %}
            {% if date %}{{ date }}{% endif %}
        </p>
        {% endif %}
    </div>
    {% if caller %}
    <div class="col-md-4 text-end">
        {{ caller() }}
    </div>
    {% endif %}
</div>
{% endmacro %}


{# ============================================================================ #}
{# 2. FORM MACROS                                                              #}
{# ============================================================================ #}

{# Form Section with Bootstrap Layout - Modern form container #}
{% macro form_section(title, action_url='', method='POST', submit_label='Submit', cancel_url='', show_flash=true) %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h1>{{ title }}</h1>
            
            {% if show_flash %}
                {{ flash_messages() }}
            {% endif %}
            
            <form method="{{ method }}" action="{{ action_url }}" class="form">
                {{ caller() }}
                
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">{{ submit_label }}</button>
                    {% if cancel_url %}
                    <a href="{{ cancel_url }}" class="btn btn-secondary">Cancel</a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>
{% endmacro %}

{# Form Input Field with Bootstrap 5 classes #}
{% macro input_field(name, label, value='', type='text', required=false, min=none, max=none, placeholder='') %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}{% if required %} *{% endif %}</label>
    <input 
        type="{{ type }}" 
        class="form-control" 
        id="{{ name }}"
        name="{{ name }}" 
        value="{{ value }}"
        {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
        {% if required %}required{% endif %}
        {% if min is not none %}min="{{ min }}"{% endif %}
        {% if max is not none %}max="{{ max }}"{% endif %}
    >
</div>
{% endmacro %}

{# Form Select Field with Bootstrap 5 classes #}
{% macro select_field(name, label, options, selected='', required=false, empty_option='-- Select --') %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}</label>
    <select class="form-select" id="{{ name }}" name="{{ name }}" {% if required %}required{% endif %}>
        {% if empty_option %}
        <option value="">{{ empty_option }}</option>
        {% endif %}
        {% for value, text in options %}
            <option value="{{ value }}" {% if value == selected or value|string == selected|string %}selected{% endif %}>
                {{ text }}
            </option>
        {% endfor %}
    </select>
</div>
{% endmacro %}

{# Form Textarea Field with Bootstrap 5 classes #}
{% macro textarea_field(name, label, value='', placeholder='', required=false, rows=3) %}
<div class="mb-3">
    <label for="{{ name }}" class="form-label">{{ label }}</label>
    <textarea 
        class="form-control" 
        id="{{ name }}"
        name="{{ name }}"
        rows="{{ rows }}"
        {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
        {% if required %}required{% endif %}
    >{{ value }}</textarea>
</div>
{% endmacro %}


{# ============================================================================ #}
{# 3. TABLE MACROS                                                             #}
{# ============================================================================ #}

{# Data Table with Dark Header and Bootstrap styling #}
{% macro data_table(headers=[]) %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                {% for header, key in headers %}
                <th scope="col">{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {{ caller() }}
        </tbody>
    </table>
</div>
{% endmacro %}

{# Clickable Table Row - Makes entire row clickable #}
{% macro table_row(url) %}
<tr onclick="window.location='{{ url }}'" style="cursor: pointer;">
    {{ caller() }}
</tr>
{% endmacro %}

{# Action Buttons for Table Rows - Small button group for row actions #}
{% macro action_buttons(buttons=[]) %}
<div class="btn-group btn-group-sm" role="group">
    {% for btn in buttons %}
        {% if btn.type == 'link' %}
        <a href="{{ btn.url }}" class="btn btn-{{ btn.style|default('info') }}" title="{{ btn.title|default('') }}">
            {{ btn.label }}
        </a>
        {% elif btn.type == 'submit' %}
        <form method="POST" action="{{ btn.url }}" style="display:inline;" 
              {% if btn.confirm %}onsubmit="return confirm('{{ btn.confirm }}');"{% endif %}>
            <button type="submit" class="btn btn-{{ btn.style|default('danger') }}" title="{{ btn.title|default('') }}">
                {{ btn.label }}
            </button>
        </form>
        {% endif %}
    {% endfor %}
</div>
{% endmacro %}

{# card layout for table data on small screens #}
{% macro card_list(title_key, keys, items, details_route) %}
    {% for item in items %}
    <div class="card mb-3" onclick="window.location='{{ url_for(details_route, competition_id=item.id) }}'" style="cursor: pointer;">
        <div class="card-body">
            
            <h5 class="card-title">{{ item[title_key] }}</h5>
            <p class="card-text">
                {% for key in keys %}
                    <strong>{{ key }}:</strong> {{ item[key] }}<br>
                {% endfor %}
            </p>
        </div>
    </div>
    {% endfor %}
{% endmacro %}

{% macro data_table_2(title_key, headers, items, details_route) %}

    <div class="table-responsive">
        {% set header_names = headers | map(attribute=1) | list %}
        {% call table(header_names) %}
            {% for item in items %}
                {% call table_row(url_for(details_route, competition_id=item.id)) %}
                    {% for key, header in headers %}
                        <td>{{ item[key] }}</td>
                    {% endfor %}
                {% endcall %}
            {% endfor %}
        {% endcall %}
    </div>
{% endmacro %}

{# Table Form with Responsive Cards - Used on main index page #}
{% macro table_form(title, headers, items, details_route, show_flash=true) %}
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">{{ title }}</h1>
                
                {% if show_flash %}
                    {{ flash_messages() }}
                {% endif %}
                
                <!-- Table for medium and larger screens -->
                <div class="table-container d-none d-md-block">
                    <!-- Table for larger screens -->
                    {{ data_table_2(title_key='name',
                                    headers=headers,
                                    items=items,
                                    details_route=details_route) }}
                </div>
                <div class="card-container d-block d-md-none">
                    <!-- Cards for small screens -->
                    {{ card_list(title_key='name',
                                 keys=['level', 'location', 'date'],
                                 items=items,
                                 details_route=details_route) }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}


{# ============================================================================ #}
{# 4. UI COMPONENT MACROS                                                      #}
{# ============================================================================ #}

{# Flash Messages Display - Shows Flask flash messages #}
{% macro flash_messages() %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
{% endmacro %}

{# Alert Box - General purpose alert component #}
{% macro alert_box(message, type='info', title='') %}
<div class="alert alert-{{ type }}" role="alert">
    {% if title %}<strong>{{ title }}</strong><br>{% endif %}
    {{ message }}
</div>
{% endmacro %}

{# Empty State Message - Shows when no data is available #}
{% macro empty_state(title, message, action_url='', action_label='') %}
<div class="alert alert-info" role="alert">
    <strong>{{ title }}</strong><br>
    {{ message }}
    {% if action_url %}
    <br><a href="{{ action_url }}" class="alert-link">{{ action_label }}</a>
    {% endif %}
</div>
{% endmacro %}

{# Button Group - Horizontal group of buttons #}
{% macro button_group(buttons=[]) %}
<div class="d-flex gap-2">
    {% for button in buttons %}
        {% if button.type == 'submit' %}
        <button type="submit" class="btn btn-{{ button.style|default('primary') }}">
            {{ button.label }}
        </button>
        {% elif button.type == 'link' %}
        <a href="{{ button.url }}" class="btn btn-{{ button.style|default('secondary') }}">
            {{ button.label }}
        </a>
        {% elif button.type == 'form' %}
        <form method="POST" action="{{ button.url }}" style="display:inline;" {% if button.confirm %}onsubmit="return confirm('{{ button.confirm }}');"{% endif %}>
            <button type="submit" class="btn btn-{{ button.style|default('danger') }}">
                {{ button.label }}
            </button>
        </form>
        {% endif %}
    {% endfor %}
    {{ caller() if caller }}
</div>
{% endmacro %}

{# Status Badge - Shows published/unpublished status #}
{% macro status_badge(published, published_label='Published', unpublished_label='Not Published') %}
{% if published %}
    <span class="badge bg-success">{{ published_label }}</span>
{% else %}
    <span class="badge bg-danger">{{ unpublished_label }}</span>
{% endif %}
{% endmacro %}

{# Ranking Badge with Medal Icons - Shows ranking with emoji medals #}
{% macro ranking_badge(rank) %}
{% if rank == 1 %}
    <span class="fw-bold">ðŸ¥‡ 1st</span>
{% elif rank == 2 %}
    <span class="fw-bold">ðŸ¥ˆ 2nd</span>
{% elif rank == 3 %}
    <span class="fw-bold">ðŸ¥‰ 3rd</span>
{% else %}
    <span class="fw-bold">{{ rank }}</span>
{% endif %}
{% endmacro %}


{# ============================================================================ #}
{# 5. LEGACY MACROS - DEPRECATED                                               #}
{# These macros are kept for backward compatibility with the users blueprint   #}
{# New code should use the modern equivalents from sections above              #}
{# ============================================================================ #}

{# LEGACY: Centered Form Card (used by users blueprint) #}
{# Use form_section() instead for new code #}
{% macro form_card(title, show_flash=true) %}
<div class="row mt-5">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6 offset-sm-1 offset-md-2 offset-lg-3">
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">{{ title }}</h1>
                
                {% if show_flash %}
                    {{ flash_messages() }}
                {% endif %}
                
                {{ caller() }}
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{# LEGACY: Form Input Field (used by users blueprint) #}
{# Use input_field() instead for new code #}
{% macro form_input(name, label=none, type='text', placeholder='', required=false, value='') %}
<div class="form-group mb-3">
    {% if label %}
        <label>{{ label }}</label>
    {% endif %}
    <input 
        type="{{ type }}" 
        name="{{ name }}" 
        class="form-control" 
        placeholder="{{ placeholder }}"
        {% if value %}value="{{ value }}"{% endif %}
        {% if required %}required{% endif %}
    >
</div>
{% endmacro %}

{# LEGACY: Form Select Field (used by users blueprint) #}
{# Use select_field() instead for new code #}
{% macro form_select(name, label, options, selected='', required=false) %}
<div class="form-group mb-3">
    <label>{{ label }}</label>
    <select name="{{ name }}" class="form-control" {% if required %}required{% endif %}>
        {% for value, text in options %}
            <option value="{{ value }}" {% if value == selected %}selected{% endif %}>
                {{ text }}
            </option>
        {% endfor %}
    </select>
</div>
{% endmacro %}

{# LEGACY: Old-style Table (deprecated) #}
{# Use data_table() instead for new code #}
{% macro table(headers) %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="thead-dark">
            <tr>
                {% for header in headers %}
                <th scope="col">{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {{ caller() }}
        </tbody>
    </table>
</div>
{% endmacro %}
